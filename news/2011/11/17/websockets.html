<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Netty.news: WebSockets in Netty</title>
<title>Netty: WebSockets in Netty</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<link href="../../../../images/favicon.ico" rel="shortcut icon">
<link href="//feeds.feedburner.com/netty_project" rel="alternate" title="News Feed" type="application/rss+xml">
<style>
  body {
    padding-top: 60px;
  }
</style>
<link href="//netdna.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" media="screen" rel="stylesheet" type="text/css">
<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" media="screen" rel="stylesheet" type="text/css">
<script src="../../../../lib/sh/scripts/shCore.js" type="text/javascript"></script>
<script src="../../../../lib/sh/scripts/shBrushXml.js" type="text/javascript"></script>
<link href="../../../../lib/sh/styles/shCore.css" rel="stylesheet" type="text/css">
<link href="../../../../lib/sh/styles/shThemeDefault.css" rel="stylesheet" type="text/css">
<link href="../../../../lib/common.css" rel="stylesheet" type="text/css">
<script src="../../../../lib/common.js" type="text/javascript"></script>
<!--[if lt IE 9]>
<script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.js" type="text/javascript"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/respond.js/1.3.0/respond.js" type="text/javascript"></script>
<![endif]-->
</head>
<body>
<a class="sr-only" href="#content" id="top">Skip navigation</a>
<nav class="navbar navbar-default navbar-fixed-top hidden-print" id="header" role="navigation">
<div class="container">
<div class="navbar-header">
<button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse" type="button">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a class="navbar-brand" href="../../../../index.html">
<span class="navbar-brand-logo"></span>
Netty project
</a>
</div>
<div class="navbar-collapse collapse">
<ul class="nav navbar-nav">
<li class="dropdown">
<a href="../../../../news/2021/05/03/quic-0-0-11-Final.html">
News
</a>
<ul class="dropdown-menu">
<li>
<a href="../../../../news/index.html">
<i class="fa fa-archive"></i>
Archive
</a>
</li>
</ul>
</li>
<li class="dropdown">
<a href="../../../../downloads.html">
Downloads
</a>
<ul class="dropdown-menu">
<li>
<a href="https://dl.bintray.com/netty/downloads/netty-4.1.63.Final.tar.bz2">
<i class="fa fa-cloud-download"></i>
4.1.63.Final
<small>&dash; 01-Apr-2021</small>
</a>
</li>
<li>
<a href="https://dl.bintray.com/netty/downloads/netty-4.0.56.Final.tar.bz2">
<i class="fa fa-cloud-download"></i>
4.0.56.Final
<small>&dash; 05-Feb-2018</small>
</a>
</li>
<li>
<a href="https://dl.bintray.com/netty/downloads/netty-3.10.6.Final-dist.tar.bz2">
<i class="fa fa-cloud-download"></i>
3.10.6.Final
<small>&dash; 29-Jun-2016</small>
</a>
</li>
<li>
<a href="https://www.tldrlegal.com/l/APACHE2">
<i class="fa fa-gavel"></i>
Apache License 2.0
</a>
</li>
<li>
<a href="https://bintray.com/netty/downloads/netty/">
<i class="fa fa-archive"></i>
Previous Releases
</a>
</li>
<li>
<a href="https://oss.sonatype.org/content/repositories/snapshots/io/netty/">
<i class="fa fa-flask"></i>
Nightly Builds
</a>
</li>
</ul>
</li>
<li class="dropdown">
<a href="../../../../wiki/index.html">
Documentation
</a>
<ul class="dropdown-menu">
<li>
<a href="../../../../wiki/user-guide.html">
<i class="fa fa-book"></i>
User guide
</a>
</li>
<li>
<a href="../../../../4.1/api/index.html">
<i class="fa fa-file-text"></i>
Javadoc - 4.1
</a>
</li>
<li>
<a href="../../../../4.0/api/index.html">
<i class="fa fa-file-text"></i>
Javadoc - 4.0
</a>
</li>
<li>
<a href="../../../../3.10/api/index.html">
<i class="fa fa-file-text"></i>
Javadoc - 3.10
</a>
</li>
<li>
<a href="../../../../wiki/all-documents.html">
<i class="fa fa-list"></i>
All Documents
</a>
</li>
<li>
<a href="../../../../wiki/related-articles.html">
<i class="fa fa-bookmark"></i>
Related Articles
</a>
</li>
<li class="hidden-xs" id="bookpromo-dropdown">
<a href="https://www.manning.com/maurer/">
<img src="../../../../images/netty-in-action.gif">
<br>
<small>
Use code <strong>mlnettyco</strong>
<br>
for a 37% discount!
</small>
</a>
</li>
</ul>
</li>
<li class="dropdown">
<a href="../../../../community.html">
Get Involved
</a>
<ul class="dropdown-menu">
<li>
<a href="https://github.com/netty/netty">
<i class="fa fa-github-square"></i>
Github
</a>
</li>
<li>
<a href="https://stackoverflow.com/questions/tagged/netty">
<i class="fa fa-stack-overflow"></i>
StackOverflow
</a>
</li>
<li>
<a href="https://twitter.com/netty_project">
<i class="fa fa-twitter-square"></i>
@netty_project
</a>
</li>
<li>
<a href="../../../../wiki/developer-guide.html">
<i class="fa fa-cogs"></i>
Developer Guide
</a>
</li>
<li>
<a href="https://webchat.freenode.net/?channels=%23netty&amp;uio=MT1mYWxzZSY5PXRydWU13">
<i class="fa fa-comment"></i>
IRC Chat
</a>
</li>
<li>
<a href="../../../../sponsor/thanks.html">
<i class="fa fa-usd"></i>
Sponsors
</a>
</li>
<li>
<a href="../../../../wiki/adopters.html">
<i class="fa fa-users"></i>
Adopters
</a>
</li>
<li>
<a href="../../../../wiki/related-projects.html">
<i class="fa fa-chain"></i>
Related Projects
</a>
</li>
</ul>
</li>
<li class="visible-xs" id="bookpromo-nav">
<a href="https://www.manning.com/maurer/">
<img src="../../../../images/netty-in-action.gif">
<br>
<small>
Use code <strong>mlnettyco</strong>
<br>
for a 37% discount!
</small>
</a>
</li>
<li>
<a href="https://feeds.feedburner.com/netty_project">
<i class="fa fa-rss"></i>
</a>
</li>
</ul>
<form action="../../../../search.html" class="navbar-form navbar-right hidden-sm" method="GET" onsubmit="return validateGlobalSearchQuery()" role="search">
<div class="form-group">
<input class="search-query form-control" id="global-search-query" name="q" placeholder="Search" type="text">
</div>
</form>
</div>
</div>
</nav>
<div id="content">
<div class="container">
<div class="row">
<div class="col-md-9">
<div class="news-item" id="main-content">
<h1>
WebSockets in Netty
</h1>
<p class="byline">
<small>
by
<a href="https://github.com/trustin">trustin</a>
<br>
on
<time datetime="2011-11-17">17-Nov-2011</time>
</small>
</p>
<div class="news-content">
<div class="entry-content">
<h3 id="HWhatareWebSockets3F"><span>What are WebSockets?</span></h3>
<p>Current web browser communications protocol is limited to the HTTP request and response paradigm - i.e. the browser requests and the server responds.</p>
<p>What if we want to use a different communications paradigm? For example, what if we want to perform 2 way communications where the server sends a request and the browser responds? A common use case would be the server notifies the client that an event has occurred.</p>
<p>This is where <span class="wikiexternallink"><a href="http://en.wikipedia.org/wiki/WebSocket">WebSockets</a></span> come into play. WebSocket is a technology providing for bi-directional, full-duplex communications channels, over a single Transmission Control Protocol (TCP) socket. In addition, because WebSockets can co-exist with other HTTP traffic over port 80 and 443, firewalls will not have to be re-configured.</p>
<p>WebSocket is part of the <span class="wikiexternallink"><a href="http://dev.w3.org/html5/websockets/">W3C</a></span> drive towards HTML 5.</p>
<h3 id="HVersionConfusion"><span>Version Confusion</span></h3>
<p>WebSockets is an evolving standard.</p>
<p>Just have a look at the different <span class="wikiexternallink"><a href="http://en.wikipedia.org/wiki/Comparison_of_WebSocket_implementations">implementations</a></span> and the different versions each support. There have been numerous version of the WebSocket standards under different names.</p>
<p>So far, browsers have converged on 2 versions.</p>
<ul>
<li>
<span class="wikiexternallink"><a href="http://tools.ietf.org/html/draft-hixie-thewebsocketprotocol-76">Hixie-76</a></span>/<span class="wikiexternallink"><a href="http://tools.ietf.org/html/draft-ietf-hybi-thewebsocketprotocol-00">HyBi-00</a></span><ul>
<li>Safari 5+, Chrome 4-13 and Firefox 4 supports this standard.</li>
<li>There are two names for this version because the Hixie-76 documentation is used as input into the new HiBi IETF working group.</li>
<li>A flaw in this standard was discovered in the handshaking which requires exchange of binary data in the HTTP body. This did not work across some proxy servers.</li>
</ul>
</li>
<li>
<span class="wikiexternallink"><a href="http://tools.ietf.org/html/draft-ietf-hybi-thewebsocketprotocol-10">HyBi-10</a></span><ul>
<li>Chrome 14-15, Firefox 7 and IE 10 Developer Preview supports this standard.</li>
<li>Handshaking is performed in HTTP request and response headers</li>
<li>Uses wire protocol version 8. You will see “Sec-WebSocket-Version: 8” in the HTTP header.</li>
</ul>
</li>
</ul>
<p>Hybi-00 and Hybi-10 both represents versions of the specification document. The version of the wire protocol are actually 0 and 8 respectively.</p>
<p>Typically, the wire protocol (sequence of bits and bytes sent over the network) does not change between different versions of the specification document. As such, the wire protocol version is set by the version of the specification document at which the change was made to the wire protocol. So version 8 of the wire protocol was specified in <span class="wikiexternallink"><a href="http://tools.ietf.org/html/draft-ietf-hybi-thewebsocketprotocol-08">Hybi-08</a></span>.</p>
<p>What changes are made between different versions of the specification document? Corrections of typos, clarification of concepts and adjustments in handshaking. The latest version is <span class="wikiexternallink"><a href="http://tools.ietf.org/html/draft-ietf-hybi-thewebsocketprotocol-17">Hybi-17</a></span> (with a wire protocol version of 13).</p>
<h3 id="HNettyWebSocketSupport"><span>Netty WebSocket Support</span></h3>
<p><strong>Netty 3.2.6</strong> supports Hixie-75 and 76 but <strong>NOT</strong> Hybi-10. Refer to the org.jboss.netty.handler.codec.http.websocket package and associated examples.</p>
<p><strong>Netty 4.0</strong> (unreleased) will support both Hixie-75 and 76 <strong>AND </strong>Hybi-10. The code is now in the Netty master branch (see <span class="wikiexternallink"><a href="https://github.com/netty/netty/pull/26">pull request #26</a></span>).</p>
<p>Points about this implementation:</p>
<ol>
<li>The existing org.jboss.netty.handler.codec.http.websocket package remains unchanged. There are quite a few frameworks using this package so we will just leave well enough alone.</li>
<li>The new code for web socket support has been placed in the org.jboss.netty.handler.codec.http.<strong>websocketx</strong> package. The “x” is intended to represent multiple versions.</li>
<li>The websocketx package supports both WebSocket versions (“Hixie-75/76/Hybi-00” and “Hybi-10”)</li>
<li>The websocketx supports both client and server.</li>
<li>Exmaples - refer to package-info.java in each package for instructions.<ul>
<li>org.jboss.netty.example.http.websocketx.autobahn - echo server used for running AutoBahn tests</li>
<li>org.jboss.netty.example.http.websocketx.client - web socket client implementation</li>
<li>org.jboss.netty.example.http.websocketx.server - web socket server implementation that echo the text you send it in upper case</li>
<li>org.jboss.netty.example.http.websocketx.sslserver - example of how to use SSL with the web socket server</li>
</ul>
</li>
<li>Frames<ul>
<li>Data is sent between client and server in frames.</li>
<li>The old websocket package implements only the DefaultWebSocketFrame. Text, binary and closing frames are encapsulated into this single class.</li>
<li>The new websocketx package implements frames as a different class: TextWebSocketFrame, BinaryWebSocketFrame, CloseWebSocketFrame, PingWebSocketFrame and PongWebSocketFrame. I felt that this made the code easier to read and understand.</li>
</ul>
</li>
<li>Encoders and Decoders<ul>
<li>Hixie-75/76/Hybi-00 is implemented as WebSocket00FrameDecoder and WebSocket00FrameEncoder.</li>
<li>Hybi-10 is implemented as WebSocket08FrameDecoder and WebSocket08FrameEncoder. The version #8 is used because the wire protocol #8 is used in conjunction with the specification document version #10.</li>
</ul>
</li>
<li>Server Handshake<ul>
<li>Implements the handshaking protocol on the server side.</li>
<li>Hixie-75/76/Hybi-00 is implemented in WebSocketServerHandshaker00</li>
<li>Hybi-10 is implemented in WebSocketServerHandshaker10</li>
<li>WebSocketServerHandshakerFactory picks the correct handshaker to use based on the handshaking request sent by the client.</li>
<li>See org.jboss.netty.example.http.websocketx.server.WebSocketServer for an example.</li>
</ul>
</li>
<li>Client Handshake<ul>
<li>Implements the handshaking protocol on the client side.</li>
<li>Hixie-75/76/Hybi-00 is implemented in WebSocketClientHandshaker00</li>
<li>Hybi-10 is implemented in WebSocketClientHandshaker10</li>
<li>WebSocketClientHandshakerFactory picks the correct handshaker to use based on the version of the specification passed in as a parameter.</li>
<li>See org.jboss.netty.example.http.websocketx.client.App for an example.</li>
</ul>
</li>
<li>This implementation has passed the <span class="wikiexternallink"><a href="http://www.tavendo.de/autobahn/testsuite.html">AutoBahn</a></span> Server Tests V 0.4.2 </li>
</ol>
<h3 id="HThankYou"><span>Thank You</span></h3>
<p>This implementation uses code from <span class="wikiexternallink"><a href="https://github.com/joewalnes/webbit">Webbit</a></span> (for which Aslak Hellesøy has written hybi-10 support) and from <span class="wikiexternallink"><a href="https://github.com/cgbystrom/netty-tools">cgbystrom</a></span> (for web socket clients).</p>
<h3 id="HNext"><span>Next</span></h3>
<p>It is my understanding that Chrome 16 will support Hybi-17. I’ll be looking to add Netty support for this web socket version shortly.</p>
</div>

</div>
<ul class="pager">
<li class="previous">
<a href="../../../../news/2011/11/10/update-on-new-web-site.html">&larr; Older</a>
</li>
<li>
<a href="../../../index.html">List all news items</a>
</li>
<li class="next">
<a href="../../../../news/2011/11/22/slf4j-or-not.html">Newer &rarr;</a>
</li>
</ul>
</div>
<div class="comments">

            <div id="disqus_thread"></div>
            <script type="text/javascript">
            var disqus_shortname = 'netty0';
            var disqus_url = "http://netty.io/news/2011/11/17/websockets.html";
            var disqus_developer = null;
            var disqus_identifier = "7216694065147753452";
            (function() {
              var dsq = document.createElement("script"); dsq.type = "text/javascript"; dsq.async = true;
              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName("head")[0] || document.getElementsByTagName("body")[0]).appendChild(dsq);
            })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript=netty0">comments powered by Disqus.</a></noscript>
          
</div>
</div>
<div class="col-md-3">
<div id="twitter-timeline" class="hidden-xs hidden-sm hidden-print" role="complementary"><a class="twitter-timeline" href="https://twitter.com/netty_project" data-widget-id="412058459593383936">Tweets by @netty_project</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?"http":"https";if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script></div>
</div>
</div>

</div>

</div>
<div class="container">
<hr>
<div id="footer">
<p>
Copyright &copy; 2021
<a href="../../../../index.html">The Netty project</a>
</p>
</div>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js" type="text/javascript"></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js" type="text/javascript"></script>
<script src="../../../../lib/common.footer.js" type="text/javascript"></script>

<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-95307-5', 'auto');
ga('require', 'displayfeatures');
ga('require', 'linkid', 'linkid.js');
ga('send', 'pageview');
</script>
</body>
</html>
