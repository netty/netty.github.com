<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Netty.docs: New and noteworthy in 5.0</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<link href="../images/favicon.ico" rel="shortcut icon">
<link href="//feeds.feedburner.com/netty_project" rel="alternate" title="News Feed" type="application/rss+xml">
<style>
  body {
    padding-top: 60px;
  }
</style>
<link href="//netdna.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" media="screen" rel="stylesheet" type="text/css">
<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" media="screen" rel="stylesheet" type="text/css">
<script src="../lib/sh/scripts/shCore.js" type="text/javascript"></script>
<script src="../lib/sh/scripts/shBrushXml.js" type="text/javascript"></script>
<link href="../lib/sh/styles/shCore.css" rel="stylesheet" type="text/css">
<link href="../lib/sh/styles/shThemeDefault.css" rel="stylesheet" type="text/css">
<link href="../lib/common.css" rel="stylesheet" type="text/css">
<script src="../lib/common.js" type="text/javascript"></script>
<!--[if lt IE 9]>
<script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.js" type="text/javascript"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/respond.js/1.3.0/respond.js" type="text/javascript"></script>
<![endif]-->
</head>
<body>
<a class="sr-only" href="#content" id="top">Skip navigation</a>
<nav class="navbar navbar-default navbar-fixed-top hidden-print" id="header" role="navigation">
<div class="container">
<div class="navbar-header">
<button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse" type="button">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a class="navbar-brand" href="../index.html">
<span class="navbar-brand-logo"></span>
Netty project
</a>
</div>
<div class="navbar-collapse collapse">
<ul class="nav navbar-nav">
<li class="dropdown">
<a href="../news/2021/01/13/4-1-58-Final.html">
News
</a>
<ul class="dropdown-menu">
<li>
<a href="../news/index.html">
<i class="fa fa-archive"></i>
Archive
</a>
</li>
</ul>
</li>
<li class="dropdown">
<a href="../downloads.html">
Downloads
</a>
<ul class="dropdown-menu">
<li>
<a href="https://dl.bintray.com/netty/downloads/netty-4.1.58.Final.tar.bz2">
<i class="fa fa-cloud-download"></i>
4.1.58.Final
<small>&dash; 13-Jan-2021</small>
</a>
</li>
<li>
<a href="https://dl.bintray.com/netty/downloads/netty-4.0.56.Final.tar.bz2">
<i class="fa fa-cloud-download"></i>
4.0.56.Final
<small>&dash; 05-Feb-2018</small>
</a>
</li>
<li>
<a href="https://dl.bintray.com/netty/downloads/netty-3.10.6.Final-dist.tar.bz2">
<i class="fa fa-cloud-download"></i>
3.10.6.Final
<small>&dash; 29-Jun-2016</small>
</a>
</li>
<li>
<a href="https://www.tldrlegal.com/l/APACHE2">
<i class="fa fa-gavel"></i>
Apache License 2.0
</a>
</li>
<li>
<a href="https://bintray.com/netty/downloads/netty/">
<i class="fa fa-archive"></i>
Previous Releases
</a>
</li>
<li>
<a href="https://oss.sonatype.org/content/repositories/snapshots/io/netty/">
<i class="fa fa-flask"></i>
Nightly Builds
</a>
</li>
</ul>
</li>
<li class="dropdown">
<a href="../wiki/index.html">
Documentation
</a>
<ul class="dropdown-menu">
<li>
<a href="../wiki/user-guide.html">
<i class="fa fa-book"></i>
User guide
</a>
</li>
<li>
<a href="../4.1/api/index.html">
<i class="fa fa-file-text"></i>
Javadoc - 4.1
</a>
</li>
<li>
<a href="../4.0/api/index.html">
<i class="fa fa-file-text"></i>
Javadoc - 4.0
</a>
</li>
<li>
<a href="../3.10/api/index.html">
<i class="fa fa-file-text"></i>
Javadoc - 3.10
</a>
</li>
<li>
<a href="../wiki/all-documents.html">
<i class="fa fa-list"></i>
All Documents
</a>
</li>
<li>
<a href="../wiki/related-articles.html">
<i class="fa fa-bookmark"></i>
Related Articles
</a>
</li>
<li class="hidden-xs" id="bookpromo-dropdown">
<a href="https://www.manning.com/maurer/">
<img src="../images/netty-in-action.gif">
<br>
<small>
Use code <strong>mlnettyco</strong>
<br>
for a 37% discount!
</small>
</a>
</li>
</ul>
</li>
<li class="dropdown">
<a href="../community.html">
Get Involved
</a>
<ul class="dropdown-menu">
<li>
<a href="https://github.com/netty/netty">
<i class="fa fa-github-square"></i>
Github
</a>
</li>
<li>
<a href="https://stackoverflow.com/questions/tagged/netty">
<i class="fa fa-stack-overflow"></i>
StackOverflow
</a>
</li>
<li>
<a href="https://twitter.com/netty_project">
<i class="fa fa-twitter-square"></i>
@netty_project
</a>
</li>
<li>
<a href="../wiki/developer-guide.html">
<i class="fa fa-cogs"></i>
Developer Guide
</a>
</li>
<li>
<a href="https://webchat.freenode.net/?channels=%23netty&amp;uio=MT1mYWxzZSY5PXRydWU13">
<i class="fa fa-comment"></i>
IRC Chat
</a>
</li>
<li>
<a href="../sponsor/thanks.html">
<i class="fa fa-usd"></i>
Sponsors
</a>
</li>
<li>
<a href="../wiki/adopters.html">
<i class="fa fa-users"></i>
Adopters
</a>
</li>
<li>
<a href="../wiki/related-projects.html">
<i class="fa fa-chain"></i>
Related Projects
</a>
</li>
</ul>
</li>
<li class="visible-xs" id="bookpromo-nav">
<a href="https://www.manning.com/maurer/">
<img src="../images/netty-in-action.gif">
<br>
<small>
Use code <strong>mlnettyco</strong>
<br>
for a 37% discount!
</small>
</a>
</li>
<li>
<a href="https://feeds.feedburner.com/netty_project">
<i class="fa fa-rss"></i>
</a>
</li>
</ul>
<form action="../search.html" class="navbar-form navbar-right hidden-sm" method="GET" onsubmit="return validateGlobalSearchQuery()" role="search">
<div class="form-group">
<input class="search-query form-control" id="global-search-query" name="q" placeholder="Search" type="text">
</div>
</form>
</div>
</div>
</nav>
<div id="content">
<div class="container">
<div class="wiki-item">
<h1>New and noteworthy in 5.0</h1>
<div class="alert alert-info">
Did you know this page is automatically generated from
<a href="https://github.com/netty/netty/wiki/New-and-noteworthy-in-5.0">a Github Wiki page?</a>
You can improve it by yourself
<a href="https://github.com/netty/netty/wiki/New-and-noteworthy-in-5.0">here!</a>
</div>
<div class="row">
<div class="col-md-9">
<div id="wiki-body" class="gollum-markdown-content">
            <div class="markdown-body">
              <p>This document walks you through the list of notable changes and new features in the major Netty release (since 4.1) to give you an idea to port your application to the new version.</p>
<p>Unlike the changes between 3.x and 4.0, 5.0 did not change a lot although it made quite a bit of breakthrough in its design simplicity.  We tried to make the transition from 4.x to 5.0 as smooth as possible, but please let us know if you encounter any issues during migration.</p>
<h2 id="wiki-h2-0">
<a id="user-content-core-changes" class="anchor" href="#core-changes" aria-hidden="true"><svg class="octicon octicon-link" viewbox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Core changes</h2>
<h3 id="wiki-h3-1">
<a id="user-content-simplified-handler-type-hierarchy" class="anchor" href="#simplified-handler-type-hierarchy" aria-hidden="true"><svg class="octicon octicon-link" viewbox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Simplified handler type hierarchy</h3>
<p><code>ChannelInboundHandler</code> and <code>ChannelOutboundHandler</code> have been merged into <a href="http://netty.io/5.0/api/io/netty/channel/ChannelHandler.html" rel="nofollow"><code>ChannelHandler</code></a>.  <a href="http://netty.io/5.0/api/io/netty/channel/ChannelHandler.html" rel="nofollow"><code>ChannelHandler</code></a> now has both inbound and outbound handler methods.</p>
<p><code>ChannelInboundHandlerAdapter</code>, <code>ChannelOutboundHandlerAdapter</code>, and <code>ChannelDuplexHandlerAdapter</code> have been deprecated and replaced by <a href="http://netty.io/5.0/api/io/netty/channel/ChannelHandlerAdapter.html" rel="nofollow"><code>ChannelHandlerAdapter</code></a>.</p>
<p>Because it is now impossible to tell if a handler is an inbound handler or an outbound handler, <code>CombinedChannelDuplexHandler</code> has been replaced by <a href="http://netty.io/5.0/api/io/netty/channel/ChannelHandlerAppender.html" rel="nofollow"><code>ChannelHandlerAppender</code></a>.</p>
<p>For more information about this change, please refer to <a href="https://github.com/netty/netty/pull/1999">the pull request #1999</a>.</p>
<h3 id="wiki-h3-2">
<a id="user-content-channelread0--messagereceived" class="anchor" href="#channelread0--messagereceived" aria-hidden="true"><svg class="octicon octicon-link" viewbox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><code>channelRead0()</code> → <code>messageReceived()</code>
</h3>
<p>I know.  It was <a href="https://github.com/netty/netty/issues/1590">a silly mistake</a>.  If you are using <a href="http://netty.io/5.0/api/io/netty/channel/SimpleChannelInboundHandler.html" rel="nofollow"><code>SimpleChannelInboundHandler</code></a>, you have to rename <code>channelRead0()</code> to <code>messageReceived()</code>.</p>
<h3 id="wiki-h3-3">
<a id="user-content-even-more-flexible-thread-model" class="anchor" href="#even-more-flexible-thread-model" aria-hidden="true"><svg class="octicon octicon-link" viewbox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Even more flexible thread model</h3>
<p>In Netty 4.x each <a href="http://netty.io/5.0/api/io/netty/channel/EventLoop.html" rel="nofollow"><code>EventLoop</code></a> is tightly coupled with a fixed thread that executes all I/O events of its registered <a href="http://netty.io/5.0/api/io/netty/channel/Channel.html" rel="nofollow"><code>Channels</code></a> and any tasks submitted to it.</p>
<p>Starting with version 5.0 an <code>EventLoop</code> does no longer use threads directly but instead makes use of an <a href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Executor.html" rel="nofollow"><code>Executor</code></a> abstraction. That is, it takes an <code>Executor</code> object as a parameter in its constructor and instead of polling for I/O
events in an endless loop each iteration is now a task that is submitted to this <code>Executor</code>.</p>
<p>If not specified else, the <code>Executor</code> used by default is a <a href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ForkJoinPool.html" rel="nofollow"><code>ForkJoinPool</code></a>. A <code>ForkJoinPool</code> has the nice property of using thread-local queues. That is, a task submitted to a <code>ForkJoinPool</code> from <code>Thread A</code> is very likely to be executed by <code>Thread A again</code>. This should provide <code>EventLoops</code> with a high level of thread affinity.</p>
<p>Furthermore, developers may also provide their own <code>Executor</code> (aka thread pool) and take over the scheduling of the <code>EventLoops</code>. One scenario where this can prove useful is when Netty is used as a part of a large scale software system. Let's say this system already uses a thread pool with a high level of parallelism to optimally perform all its tasks. Netty 4.x would simply spawn its own threads and completely ignore the fact that it's part of a larger system. Starting with Netty 5.0, developers can run Netty and the rest of the system in the same thread pool and potentially improve performance by applying better scheduling strategies and through less scheduling overhead (due to fewer threads). For a detailed discussion of this change please have a look at GitHub issue <a href="https://github.com/netty/netty/issues/2250">2250</a>.</p>
<p>It shall be mentioned, that this change does not in any way affect the way <a href="http://netty.io/5.0/api/io/netty/channel/ChannelHandler.html" rel="nofollow"><code>ChannelHandlers</code></a> are developed. From a developer's point of view, the only thing that changes is that it's no longer guaranteed that a <code>ChannelHandler</code> will always be executed by the same thread. It is, however, guaranteed that it will never be executed by two or more threads at the same time. Furthermore, Netty will also take care of any memory visibility issues that might occur. So there's no need to worry about thread-safety and <code>volatile</code> variables within a <code>ChannelHandler</code>.</p>
<p>An implication of this change is that <a href="http://netty.io/5.0/api/io/netty/channel/nio/NioEventLoop.html" rel="nofollow"><code>NioEventLoop</code></a>, <a href="http://netty.io/5.0/api/io/netty/channel/nio/NioEventLoopGroup.html" rel="nofollow"><code>NioEventLoopGroup</code></a>, <a href="http://netty.io/5.0/api/io/netty/channel/epoll/EpollEventLoop.html" rel="nofollow"><code>EpollEventLoop</code></a> and
<a href="http://netty.io/5.0/api/io/netty/channel/epoll/EpollEventLoopGroup.html" rel="nofollow"><code>EpollEventLoopGroup</code></a> do no longer take <a href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ThreadFactory.html" rel="nofollow"><code>ThreadFactory</code></a> objects as constructor arguments. The constructors of these classes have been updated to take <a href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Executor.html" rel="nofollow"><code>Executor</code></a> and <a href="http://netty.io/5.0/api/io/netty/concurrent/ExecutorFactory.html" rel="nofollow"><code>ExecutorFactory</code></a> objects instead.</p>
<h3 id="wiki-h3-4">
<a id="user-content-a-better-channelderegister" class="anchor" href="#a-better-channelderegister" aria-hidden="true"><svg class="octicon octicon-link" viewbox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>A better <code>Channel.deregister(...)</code>
</h3>
<p>Originally introduced in Netty 4.0, the behaviour of <code>Channel.deregister(...)</code> was updated in version 5.0 to be in line
with Netty's thread model.</p>
<p>It's now ensured that all tasks submitted to an <a href="http://netty.io/5.0/api/io/netty/channel/EventLoop.html" rel="nofollow"><code>EventLoop</code></a> from within a <a href="http://netty.io/5.0/api/io/netty/channel/ChannelHandler.html" rel="nofollow"><code>ChannelHandler</code></a> will have been executed by that
<a href="http://netty.io/5.0/api/io/netty/channel/EventLoop.html" rel="nofollow"><code>EventLoop</code></a> before the <a href="http://netty.io/5.0/api/io/netty/channel/Channel.html" rel="nofollow"><code>Channel</code></a> is actually deregistered. However, <code>Channel.deregister(...)</code> remains a non blocking operation, so one has to wait for the returned <a href="http://netty.io/5.0/api/io/netty/channel/ChannelFuture.html" rel="nofollow"><code>ChannelFuture</code></a> to succeed before it's safe to register the <code>Channel</code> with another <code>EventLoop</code>.</p>
<p>After having called <code>Channel.deregister(...)</code> any attempt to submit a new task (<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Runnable.html" rel="nofollow"><code>Runnable</code></a> or <a href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Callable.html" rel="nofollow"><code>Callable</code></a>) to the
<code>EventLoop</code> from within a <code>ChannelHandler</code> will trigger a <a href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/RejectedExecutionException.html" rel="nofollow"><code>RejectedExecutionException</code></a>. Once the <code>Channel</code> is registered with another <code>EventLoop</code> again, everything will work as usual.</p>
<p>A task submitted from within <code>ChannelHandler</code> via any of the <code>EventLoop.schedule*(...)</code> methods will stop execution
after the <code>Channel</code> was deregistered from its <code>EventLoop</code>. The tasks are automatically moved to the new
<code>EventLoop</code> and will resume execution after the <code>Channel</code> is registered again. This limitation only affects tasks
that are scheduled to execute while the <code>Channel</code> is in a deregistered state. Tasks who's delay/period is long enough
will not be affected.</p>
<p>Even though it's not recommended, it is possible to overcome the above restrictions. Netty 5.0 introduces a new method
<code>EventLoop.unwrap()</code> that returns the original <code>EventLoop</code> that does not perform any sanity checks. More precisely, when submitting tasks to or scheduling tasks with an "unwrapped" <code>EventLoop</code>, it cannot be assured that these tasks will not be executed concurrently and scheduled tasks will also not be moved between <code>EventLoops</code> automatically.</p>

            </div>

        </div></div>
<div class="toc-container col-md-3 hidden-xs hidden-sm hidden-print" role="complementary">
<div class="toc well">
<ul class="nav nav-list nav-stacked">
<li class="nav-header">Table of Contents
</li><li><a href="#wiki-h2-0" title="Core changes">Core changes</a>
<ul class="nav nav-list nav-stacked"><li><a href="#wiki-h3-1" title="Simplified handler type hierarchy">Simplified handler type hierarchy</a>
</li><li><a href="#wiki-h3-2" title="channelRead0() → messageReceived()">channelRead0() → messageReceived()</a>
</li><li><a href="#wiki-h3-3" title="Even more flexible thread model">Even more flexible thread model</a>
</li><li><a href="#wiki-h3-4" title="A better Channel.deregister(...)">A better Channel.deregister(...)</a>
</li><li><a href="#wiki-h3-5" title="Pages 27">Pages 27</a>
</li></ul>
</li></ul>
</div>
</div>
</div>

<div class="row">
<div class="col-md-9">
<div class="text-right">
<small>Last retrieved on 13-Jan-2021</small>
</div>
</div>
</div>
</div>

</div>

</div>
<div class="container">
<hr>
<div id="footer">
<p>
Copyright &copy; 2021
<a href="../index.html">The Netty project</a>
</p>
</div>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js" type="text/javascript"></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js" type="text/javascript"></script>
<script src="../lib/common.footer.js" type="text/javascript"></script>

<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-95307-5', 'auto');
ga('require', 'displayfeatures');
ga('require', 'linkid', 'linkid.js');
ga('send', 'pageview');
</script>
</body>
</html>
