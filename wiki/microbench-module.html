<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Netty.docs: Microbench module</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <link href="../images/favicon.ico" rel="shortcut icon">
    <link href="http://feeds.feedburner.com/netty_project" rel="alternate" title="News Feed" type="application/rss+xml">
    <style>
      body {
        padding-top: 60px;
      }
    </style>
    <link href="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css" media="screen" rel="stylesheet" type="text/css">
    <link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" media="screen" rel="stylesheet" type="text/css">
    <script src="../lib/sh/scripts/shCore.js" type="text/javascript"></script>
    <script src="../lib/sh/scripts/shBrushXml.js" type="text/javascript"></script>
    <link href="../lib/sh/styles/shCore.css" rel="stylesheet" type="text/css">
    <link href="../lib/sh/styles/shThemeDefault.css" rel="stylesheet" type="text/css">
    <link href="../lib/common.css" rel="stylesheet" type="text/css">
    <script src="../lib/common.js" type="text/javascript"></script>
    <!--[if lt IE 9]>
      <script src="http://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.js" type="text/javascript"></script>
      <script src="http://cdnjs.cloudflare.com/ajax/libs/respond.js/1.3.0/respond.js" type="text/javascript"></script>
    <![endif]-->
  </head>
  <body>
    <a class="sr-only" href="#content" id="top">Skip navigation</a>
    <nav class="navbar navbar-default navbar-fixed-top hidden-print" id="header" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse" type="button">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">
            <span class="navbar-brand-logo"></span>
            Netty project
          </a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="dropdown">
              <a href="../news/2014/01/21/4-0-15-Final.html">
                News
              </a>
              <ul class="dropdown-menu">
                <li>
                  <a href="../news/index.html">
                    <i class="fa fa-archive"></i>
                    Archive
                  </a>
                </li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="../downloads.html">
                Downloads
              </a>
              <ul class="dropdown-menu">
                <li>
                  <a href="http://dl.bintray.com/netty/downloads/netty-5.0.0.Alpha1.tar.bz2">
                    <i class="fa fa-cloud-download"></i>
                    5.0.0.Alpha1
                    <small>&dash; 22-Dec-2013</small>
                  </a>
                </li>
                <li>
                  <a href="http://dl.bintray.com/netty/downloads/netty-4.0.15.Final.tar.bz2">
                    <i class="fa fa-cloud-download"></i>
                    4.0.15.Final
                    <small>&dash; 21-Jan-2014</small>
                  </a>
                </li>
                <li>
                  <a href="http://dl.bintray.com/netty/downloads/netty-3.9.0.Final-dist.tar.bz2">
                    <i class="fa fa-cloud-download"></i>
                    3.9.0.Final
                    <small>&dash; 22-Dec-2013</small>
                  </a>
                </li>
                <li>
                  <a href="http://www.tldrlegal.com/l/APACHE2">
                    <i class="fa fa-gavel"></i>
                    Apache License 2.0
                  </a>
                </li>
                <li>
                  <a href="https://bintray.com/netty/downloads/netty/">
                    <i class="fa fa-archive"></i>
                    Previous Releases
                  </a>
                </li>
                <li>
                  <a href="https://secure.motd.kr/jenkins/view/Netty/">
                    <i class="fa fa-flask"></i>
                    Nightly Builds
                  </a>
                </li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="../wiki/index.html">
                Documentation
              </a>
              <ul class="dropdown-menu">
                <li>
                  <a href="../wiki/user-guide.html">
                    <i class="fa fa-book"></i>
                    User guide
                  </a>
                </li>
                <li>
                  <a href="../5.0/api/index.html">
                    <i class="fa fa-file-text"></i>
                    Javadoc - 5.0
                  </a>
                </li>
                <li>
                  <a href="../4.0/api/index.html">
                    <i class="fa fa-file-text"></i>
                    Javadoc - 4.0
                  </a>
                </li>
                <li>
                  <a href="../3.9/api/index.html">
                    <i class="fa fa-file-text"></i>
                    Javadoc - 3.9
                  </a>
                </li>
                <li>
                  <a href="../wiki/all-documents.html">
                    <i class="fa fa-list"></i>
                    All Documents
                  </a>
                </li>
                <li>
                  <a href="../wiki/related-articles.html">
                    <i class="fa fa-bookmark"></i>
                    Related Articles
                  </a>
                </li>
                <li>
                  <a href="../wiki/related-projects.html">
                    <i class="fa fa-bookmark"></i>
                    Related Projects
                  </a>
                </li>
                <li class="hidden-xs" id="bookpromo-dropdown">
                  <a href="http://www.manning.com/maurer/">
                    <img src="../images/netty-in-action.gif">
                    <br>
                    <small>
                      Use code <strong>mlnettyco</strong>
                      <br>
                      for a 37% discount!
                    </small>
                  </a>
                </li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="../community.html">
                Get Involved
              </a>
              <ul class="dropdown-menu">
                <li>
                  <a href="https://github.com/netty/netty">
                    <i class="fa fa-github-square"></i>
                    Github
                  </a>
                </li>
                <li>
                  <a href="http://stackoverflow.com/questions/tagged/netty">
                    <i class="fa fa-stack-overflow"></i>
                    StackOverflow
                  </a>
                </li>
                <li>
                  <a href="https://twitter.com/netty_project">
                    <i class="fa fa-twitter-square"></i>
                    @netty_project
                  </a>
                </li>
                <li>
                  <a href="../wiki/developer-guide.html">
                    <i class="fa fa-cogs"></i>
                    Developer Guide
                  </a>
                </li>
                <li>
                  <a href="http://webchat.freenode.net/?channels=%23netty&amp;uio=MT1mYWxzZSY5PXRydWU13">
                    <i class="fa fa-comment"></i>
                    IRC Chat
                  </a>
                </li>
              </ul>
            </li>
            <li class="visible-xs" id="bookpromo-nav">
              <a href="http://www.manning.com/maurer/">
                <img src="../images/netty-in-action.gif">
                <br>
                <small>
                  Use code <strong>mlnettyco</strong>
                  <br>
                  for a 37% discount!
                </small>
              </a>
            </li>
            <li>
              <a href="http://feeds.feedburner.com/netty_project">
                <i class="fa fa-rss"></i>
              </a>
            </li>
          </ul>
          <form action="../search.html" class="navbar-form navbar-right hidden-sm" method="GET" onsubmit="return validateGlobalSearchQuery()" role="search">
            <div class="form-group">
              <input class="search-query form-control" id="global-search-query" name="q" placeholder="Search" type="text">
            </div>
          </form>
        </div>
      </div>
    </nav>
    <div id="content">
      <div class="container">
        <div class="wiki-item">
          <h1>Microbench module</h1>
          <div class="alert alert-info">
            Did you know this page is automatically generated from
            <a href="https://github.com/netty/netty/wiki/Microbench-module">a Github Wiki page?</a>
            You can improve it by yourself
            <a href="https://github.com/netty/netty/wiki/Microbench-module">here!</a>
          </div>
          <div class="row">
          <div class="col-md-9">
          <div id="wiki-body" class="gollum-markdown-content instapaper_body">
              <div class="markdown-body">
                <p>Netty has a module called 'netty-microbench' which performs a series of micro-benchmark tests.  It is built on top of <a href="http://openjdk.java.net/projects/code-tools/jmh/">OpenJDK JMH</a>, the preferred microbenchmarking solution for HotSpot. It has the "batteries included", so you don't need extra dependencies to get started.</p>
          
          <h2 id="wiki-h2-0">
          <a name="running-the-benchmarks" class="anchor" href="#running-the-benchmarks"><span class="octicon octicon-link"></span></a>Running the Benchmarks</h2>
          
          <p>You can run the benchmarks from the command line through maven or directly in your IDE. To run all tests with the default settings, use <code>mvn -DskipTests=false test</code>. You need to explicitly set <code>skipTests=false</code> because we don't want to run the (potentially time consuming) microbenchmarks to be executed as unit tests during regular test runs.</p>
          
          <p>If all goes well, you'll see JMH performing warmup and benchmark iterations on the number of forks, presenting you with nice a nice summary. Here's how a typical benchmark run looks like (you'll see lots of them in the output):</p>
          
          <div class="highlight"><pre><span class="cp"># Fork: 2 of 2</span>&#x000A;<span class="cp"># Warmup: 10 iterations, 1 s each</span>&#x000A;<span class="cp"># Measurement: 10 iterations, 1 s each</span>&#x000A;<span class="cp"># Threads: 1 thread, will synchronize iterations</span>&#x000A;<span class="cp"># Benchmark mode: Throughput, ops/time</span>&#x000A;<span class="cp"># Running: io.netty.microbench.buffer.ByteBufAllocatorBenchmark.pooledDirectAllocAndFree_1_0</span>&#x000A;<span class="cp"># Warmup Iteration   1: 8454.103 ops/ms</span>&#x000A;<span class="cp"># Warmup Iteration   2: 11551.524 ops/ms</span>&#x000A;<span class="cp"># Warmup Iteration   3: 11677.575 ops/ms</span>&#x000A;<span class="cp"># Warmup Iteration   4: 11404.954 ops/ms</span>&#x000A;<span class="cp"># Warmup Iteration   5: 11553.299 ops/ms</span>&#x000A;<span class="cp"># Warmup Iteration   6: 11514.766 ops/ms</span>&#x000A;<span class="cp"># Warmup Iteration   7: 11661.768 ops/ms</span>&#x000A;<span class="cp"># Warmup Iteration   8: 11667.577 ops/ms</span>&#x000A;<span class="cp"># Warmup Iteration   9: 11551.240 ops/ms</span>&#x000A;<span class="cp"># Warmup Iteration  10: 11692.991 ops/ms</span>&#x000A;<span class="n">Iteration</span>   <span class="mi">1</span><span class="o">:</span> <span class="mf">11633.877</span> <span class="n">ops</span><span class="o">/</span><span class="n">ms</span>&#x000A;<span class="n">Iteration</span>   <span class="mi">2</span><span class="o">:</span> <span class="mf">11740.063</span> <span class="n">ops</span><span class="o">/</span><span class="n">ms</span>&#x000A;<span class="n">Iteration</span>   <span class="mi">3</span><span class="o">:</span> <span class="mf">11751.798</span> <span class="n">ops</span><span class="o">/</span><span class="n">ms</span>&#x000A;<span class="n">Iteration</span>   <span class="mi">4</span><span class="o">:</span> <span class="mf">11260.071</span> <span class="n">ops</span><span class="o">/</span><span class="n">ms</span>&#x000A;<span class="n">Iteration</span>   <span class="mi">5</span><span class="o">:</span> <span class="mf">11461.010</span> <span class="n">ops</span><span class="o">/</span><span class="n">ms</span>&#x000A;<span class="n">Iteration</span>   <span class="mi">6</span><span class="o">:</span> <span class="mf">11642.912</span> <span class="n">ops</span><span class="o">/</span><span class="n">ms</span>&#x000A;<span class="n">Iteration</span>   <span class="mi">7</span><span class="o">:</span> <span class="mf">11808.595</span> <span class="n">ops</span><span class="o">/</span><span class="n">ms</span>&#x000A;<span class="n">Iteration</span>   <span class="mi">8</span><span class="o">:</span> <span class="mf">11683.780</span> <span class="n">ops</span><span class="o">/</span><span class="n">ms</span>&#x000A;<span class="n">Iteration</span>   <span class="mi">9</span><span class="o">:</span> <span class="mf">11750.292</span> <span class="n">ops</span><span class="o">/</span><span class="n">ms</span>&#x000A;<span class="n">Iteration</span>  <span class="mi">10</span><span class="o">:</span> <span class="mf">11769.986</span> <span class="n">ops</span><span class="o">/</span><span class="n">ms</span>&#x000A;&#x000A;<span class="n">Result</span> <span class="o">:</span> <span class="mf">11650.238</span> <span class="err">Â±</span><span class="p">(</span><span class="mf">99.9</span><span class="o">%</span><span class="p">)</span> <span class="mf">229.698</span> <span class="n">ops</span><span class="o">/</span><span class="n">ms</span>&#x000A;  <span class="nl">Statistics:</span> <span class="p">(</span><span class="n">min</span><span class="p">,</span> <span class="n">avg</span><span class="p">,</span> <span class="n">max</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mf">11260.071</span><span class="p">,</span> <span class="mf">11650.238</span><span class="p">,</span> <span class="mf">11808.595</span><span class="p">),</span> <span class="n">stdev</span> <span class="o">=</span> <span class="mf">169.080</span>&#x000A;  <span class="n">Confidence</span> <span class="n">interval</span> <span class="p">(</span><span class="mf">99.9</span><span class="o">%</span><span class="p">)</span><span class="o">:</span> <span class="p">[</span><span class="mf">11420.540</span><span class="p">,</span> <span class="mf">11879.937</span><span class="p">]</span></pre></div>
          
          <p>Finally, the test output will looks similar to this (depending on your system setup and configuration):</p>
          
          <div class="highlight"><pre><span class="n">Benchmark</span>                                                                <span class="n">Mode</span>   <span class="n">Samples</span>         <span class="n">Mean</span>   <span class="n">Mean</span> <span class="n">error</span>    <span class="n">Units</span>&#x000A;<span class="n">i</span><span class="p">.</span><span class="n">n</span><span class="p">.</span><span class="n">m</span><span class="p">.</span><span class="n">b</span><span class="p">.</span><span class="n">ByteBufAllocatorBenchmark</span><span class="p">.</span><span class="n">pooledDirectAllocAndFree_1_0</span>          <span class="n">thrpt</span>        <span class="mi">20</span>    <span class="mf">11658.812</span>      <span class="mf">120.728</span>   <span class="n">ops</span><span class="o">/</span><span class="n">ms</span>&#x000A;<span class="n">i</span><span class="p">.</span><span class="n">n</span><span class="p">.</span><span class="n">m</span><span class="p">.</span><span class="n">b</span><span class="p">.</span><span class="n">ByteBufAllocatorBenchmark</span><span class="p">.</span><span class="n">pooledDirectAllocAndFree_2_256</span>        <span class="n">thrpt</span>        <span class="mi">20</span>    <span class="mf">10308.626</span>      <span class="mf">147.528</span>   <span class="n">ops</span><span class="o">/</span><span class="n">ms</span>&#x000A;<span class="n">i</span><span class="p">.</span><span class="n">n</span><span class="p">.</span><span class="n">m</span><span class="p">.</span><span class="n">b</span><span class="p">.</span><span class="n">ByteBufAllocatorBenchmark</span><span class="p">.</span><span class="n">pooledDirectAllocAndFree_3_1024</span>       <span class="n">thrpt</span>        <span class="mi">20</span>     <span class="mf">8855.815</span>       <span class="mf">55.933</span>   <span class="n">ops</span><span class="o">/</span><span class="n">ms</span>&#x000A;<span class="n">i</span><span class="p">.</span><span class="n">n</span><span class="p">.</span><span class="n">m</span><span class="p">.</span><span class="n">b</span><span class="p">.</span><span class="n">ByteBufAllocatorBenchmark</span><span class="p">.</span><span class="n">pooledDirectAllocAndFree_4_4096</span>       <span class="n">thrpt</span>        <span class="mi">20</span>     <span class="mf">5545.538</span>     <span class="mf">1279.721</span>   <span class="n">ops</span><span class="o">/</span><span class="n">ms</span>&#x000A;<span class="n">i</span><span class="p">.</span><span class="n">n</span><span class="p">.</span><span class="n">m</span><span class="p">.</span><span class="n">b</span><span class="p">.</span><span class="n">ByteBufAllocatorBenchmark</span><span class="p">.</span><span class="n">pooledDirectAllocAndFree_5_16384</span>      <span class="n">thrpt</span>        <span class="mi">20</span>     <span class="mf">6741.581</span>       <span class="mf">75.975</span>   <span class="n">ops</span><span class="o">/</span><span class="n">ms</span>&#x000A;<span class="n">i</span><span class="p">.</span><span class="n">n</span><span class="p">.</span><span class="n">m</span><span class="p">.</span><span class="n">b</span><span class="p">.</span><span class="n">ByteBufAllocatorBenchmark</span><span class="p">.</span><span class="n">pooledDirectAllocAndFree_6_65536</span>      <span class="n">thrpt</span>        <span class="mi">20</span>     <span class="mf">7252.869</span>       <span class="mf">70.609</span>   <span class="n">ops</span><span class="o">/</span><span class="n">ms</span>&#x000A;<span class="n">i</span><span class="p">.</span><span class="n">n</span><span class="p">.</span><span class="n">m</span><span class="p">.</span><span class="n">b</span><span class="p">.</span><span class="n">ByteBufAllocatorBenchmark</span><span class="p">.</span><span class="n">pooledHeapAllocAndFree_1_0</span>            <span class="n">thrpt</span>        <span class="mi">20</span>     <span class="mf">9750.225</span>       <span class="mf">73.900</span>   <span class="n">ops</span><span class="o">/</span><span class="n">ms</span>&#x000A;<span class="n">i</span><span class="p">.</span><span class="n">n</span><span class="p">.</span><span class="n">m</span><span class="p">.</span><span class="n">b</span><span class="p">.</span><span class="n">ByteBufAllocatorBenchmark</span><span class="p">.</span><span class="n">pooledHeapAllocAndFree_2_256</span>          <span class="n">thrpt</span>        <span class="mi">20</span>     <span class="mf">9936.639</span>      <span class="mf">657.818</span>   <span class="n">ops</span><span class="o">/</span><span class="n">ms</span>&#x000A;<span class="n">i</span><span class="p">.</span><span class="n">n</span><span class="p">.</span><span class="n">m</span><span class="p">.</span><span class="n">b</span><span class="p">.</span><span class="n">ByteBufAllocatorBenchmark</span><span class="p">.</span><span class="n">pooledHeapAllocAndFree_3_1024</span>         <span class="n">thrpt</span>        <span class="mi">20</span>     <span class="mf">8903.130</span>      <span class="mf">197.533</span>   <span class="n">ops</span><span class="o">/</span><span class="n">ms</span>&#x000A;<span class="n">i</span><span class="p">.</span><span class="n">n</span><span class="p">.</span><span class="n">m</span><span class="p">.</span><span class="n">b</span><span class="p">.</span><span class="n">ByteBufAllocatorBenchmark</span><span class="p">.</span><span class="n">pooledHeapAllocAndFree_4_4096</span>         <span class="n">thrpt</span>        <span class="mi">20</span>     <span class="mf">6664.157</span>       <span class="mf">74.163</span>   <span class="n">ops</span><span class="o">/</span><span class="n">ms</span>&#x000A;<span class="n">i</span><span class="p">.</span><span class="n">n</span><span class="p">.</span><span class="n">m</span><span class="p">.</span><span class="n">b</span><span class="p">.</span><span class="n">ByteBufAllocatorBenchmark</span><span class="p">.</span><span class="n">pooledHeapAllocAndFree_5_16384</span>        <span class="n">thrpt</span>        <span class="mi">20</span>     <span class="mf">6374.924</span>      <span class="mf">337.869</span>   <span class="n">ops</span><span class="o">/</span><span class="n">ms</span>&#x000A;<span class="n">i</span><span class="p">.</span><span class="n">n</span><span class="p">.</span><span class="n">m</span><span class="p">.</span><span class="n">b</span><span class="p">.</span><span class="n">ByteBufAllocatorBenchmark</span><span class="p">.</span><span class="n">pooledHeapAllocAndFree_6_65536</span>        <span class="n">thrpt</span>        <span class="mi">20</span>     <span class="mf">6386.337</span>       <span class="mf">44.960</span>   <span class="n">ops</span><span class="o">/</span><span class="n">ms</span>&#x000A;<span class="n">i</span><span class="p">.</span><span class="n">n</span><span class="p">.</span><span class="n">m</span><span class="p">.</span><span class="n">b</span><span class="p">.</span><span class="n">ByteBufAllocatorBenchmark</span><span class="p">.</span><span class="n">unpooledDirectAllocAndFree_1_0</span>        <span class="n">thrpt</span>        <span class="mi">20</span>     <span class="mf">2137.241</span>       <span class="mf">30.792</span>   <span class="n">ops</span><span class="o">/</span><span class="n">ms</span>&#x000A;<span class="n">i</span><span class="p">.</span><span class="n">n</span><span class="p">.</span><span class="n">m</span><span class="p">.</span><span class="n">b</span><span class="p">.</span><span class="n">ByteBufAllocatorBenchmark</span><span class="p">.</span><span class="n">unpooledDirectAllocAndFree_2_256</span>      <span class="n">thrpt</span>        <span class="mi">20</span>     <span class="mf">1873.727</span>       <span class="mf">41.843</span>   <span class="n">ops</span><span class="o">/</span><span class="n">ms</span>&#x000A;<span class="n">i</span><span class="p">.</span><span class="n">n</span><span class="p">.</span><span class="n">m</span><span class="p">.</span><span class="n">b</span><span class="p">.</span><span class="n">ByteBufAllocatorBenchmark</span><span class="p">.</span><span class="n">unpooledDirectAllocAndFree_3_1024</span>     <span class="n">thrpt</span>        <span class="mi">20</span>     <span class="mf">1902.025</span>       <span class="mf">34.473</span>   <span class="n">ops</span><span class="o">/</span><span class="n">ms</span>&#x000A;<span class="n">i</span><span class="p">.</span><span class="n">n</span><span class="p">.</span><span class="n">m</span><span class="p">.</span><span class="n">b</span><span class="p">.</span><span class="n">ByteBufAllocatorBenchmark</span><span class="p">.</span><span class="n">unpooledDirectAllocAndFree_4_4096</span>     <span class="n">thrpt</span>        <span class="mi">20</span>     <span class="mf">1534.347</span>       <span class="mf">20.509</span>   <span class="n">ops</span><span class="o">/</span><span class="n">ms</span>&#x000A;<span class="n">i</span><span class="p">.</span><span class="n">n</span><span class="p">.</span><span class="n">m</span><span class="p">.</span><span class="n">b</span><span class="p">.</span><span class="n">ByteBufAllocatorBenchmark</span><span class="p">.</span><span class="n">unpooledDirectAllocAndFree_5_16384</span>    <span class="n">thrpt</span>        <span class="mi">20</span>      <span class="mf">838.804</span>       <span class="mf">12.575</span>   <span class="n">ops</span><span class="o">/</span><span class="n">ms</span>&#x000A;<span class="n">i</span><span class="p">.</span><span class="n">n</span><span class="p">.</span><span class="n">m</span><span class="p">.</span><span class="n">b</span><span class="p">.</span><span class="n">ByteBufAllocatorBenchmark</span><span class="p">.</span><span class="n">unpooledDirectAllocAndFree_6_65536</span>    <span class="n">thrpt</span>        <span class="mi">20</span>      <span class="mf">276.976</span>        <span class="mf">3.021</span>   <span class="n">ops</span><span class="o">/</span><span class="n">ms</span>&#x000A;<span class="n">i</span><span class="p">.</span><span class="n">n</span><span class="p">.</span><span class="n">m</span><span class="p">.</span><span class="n">b</span><span class="p">.</span><span class="n">ByteBufAllocatorBenchmark</span><span class="p">.</span><span class="n">unpooledHeapAllocAndFree_1_0</span>          <span class="n">thrpt</span>        <span class="mi">20</span>    <span class="mf">35820.568</span>      <span class="mf">259.187</span>   <span class="n">ops</span><span class="o">/</span><span class="n">ms</span>&#x000A;<span class="n">i</span><span class="p">.</span><span class="n">n</span><span class="p">.</span><span class="n">m</span><span class="p">.</span><span class="n">b</span><span class="p">.</span><span class="n">ByteBufAllocatorBenchmark</span><span class="p">.</span><span class="n">unpooledHeapAllocAndFree_2_256</span>        <span class="n">thrpt</span>        <span class="mi">20</span>    <span class="mf">19660.951</span>      <span class="mf">295.012</span>   <span class="n">ops</span><span class="o">/</span><span class="n">ms</span>&#x000A;<span class="n">i</span><span class="p">.</span><span class="n">n</span><span class="p">.</span><span class="n">m</span><span class="p">.</span><span class="n">b</span><span class="p">.</span><span class="n">ByteBufAllocatorBenchmark</span><span class="p">.</span><span class="n">unpooledHeapAllocAndFree_3_1024</span>       <span class="n">thrpt</span>        <span class="mi">20</span>     <span class="mf">6264.614</span>       <span class="mf">77.704</span>   <span class="n">ops</span><span class="o">/</span><span class="n">ms</span>&#x000A;<span class="n">i</span><span class="p">.</span><span class="n">n</span><span class="p">.</span><span class="n">m</span><span class="p">.</span><span class="n">b</span><span class="p">.</span><span class="n">ByteBufAllocatorBenchmark</span><span class="p">.</span><span class="n">unpooledHeapAllocAndFree_4_4096</span>       <span class="n">thrpt</span>        <span class="mi">20</span>     <span class="mf">2921.598</span>       <span class="mf">95.492</span>   <span class="n">ops</span><span class="o">/</span><span class="n">ms</span>&#x000A;<span class="n">i</span><span class="p">.</span><span class="n">n</span><span class="p">.</span><span class="n">m</span><span class="p">.</span><span class="n">b</span><span class="p">.</span><span class="n">ByteBufAllocatorBenchmark</span><span class="p">.</span><span class="n">unpooledHeapAllocAndFree_5_16384</span>      <span class="n">thrpt</span>        <span class="mi">20</span>      <span class="mf">991.631</span>       <span class="mf">49.220</span>   <span class="n">ops</span><span class="o">/</span><span class="n">ms</span>&#x000A;<span class="n">i</span><span class="p">.</span><span class="n">n</span><span class="p">.</span><span class="n">m</span><span class="p">.</span><span class="n">b</span><span class="p">.</span><span class="n">ByteBufAllocatorBenchmark</span><span class="p">.</span><span class="n">unpooledHeapAllocAndFree_6_65536</span>      <span class="n">thrpt</span>        <span class="mi">20</span>      <span class="mf">261.718</span>       <span class="mf">11.108</span>   <span class="n">ops</span><span class="o">/</span><span class="n">ms</span>&#x000A;<span class="n">Tests</span> <span class="n">run</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Failures</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Errors</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Skipped</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Time</span> <span class="n">elapsed</span><span class="o">:</span> <span class="mf">993.382</span> <span class="n">sec</span> <span class="o">-</span> <span class="n">in</span> <span class="n">io</span><span class="p">.</span><span class="n">netty</span><span class="p">.</span><span class="n">microbench</span><span class="p">.</span><span class="n">buffer</span><span class="p">.</span><span class="n">ByteBufAllocatorBenchmark</span></pre></div>
          
          <p>You can also run the benchmarks directly from your IDE. If you've imported the netty parent project, open the <code>microbench</code> subproject and navigate to the <code>src/test/java/io/netty/microbench</code> namespace. In the <code>buffer</code> namespace, you can run the <code>ByteBufAllocatorBenchmark</code> like any other JUnit-based test. The main difference is that (as of now), you can only run the full benchmark at once, not each sub-benchmark individually. You should see the same output in the console as you did see when running it directly through <code>mvn</code>.</p>
          
          <h2 id="wiki-h2-1">
          <a name="writing-benchmarks" class="anchor" href="#writing-benchmarks"><span class="octicon octicon-link"></span></a>Writing Benchmarks</h2>
          
          <p>Writing the benchmark itself is not hard, but getting it right is. This not because the microbench project is difficult to use, but more because you need to avoid common pitfalls when writing them. Thankfully, the JMH suite provides helpful annotations and features to mitigate most of them. To get started, you need to make your benchmark extend the <code>AbstractMicrobenchmark</code>, which makes sure the test gets run through JUnit and configures some defaults:</p>
          
          <div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyBenchmark</span> <span class="kd">extends</span> <span class="n">AbstractMicrobenchmark</span> <span class="o">{</span>&#x000A;&#x000A;<span class="o">}</span></pre></div>
          
          <p>The next step is to create a method which is annotated with <code>@GenerateMicroBenchmark</code> (and give it a descriptive name):</p>
          
          <div class="highlight"><pre><span class="nd">@GenerateMicroBenchmark</span>&#x000A;<span class="kd">public</span> <span class="kt">void</span> <span class="nf">measureSomethingHere</span><span class="o">()</span> <span class="o">{</span>&#x000A;&#x000A;<span class="o">}</span></pre></div>
          
          <p>The best idea now is to look <a href="http://hg.openjdk.java.net/code-tools/jmh/file/tip/jmh-samples/src/main/java/org/openjdk/jmh/samples/">here</a> for samples and inspiration on how to write proper JMH tests. Also, check out <a href="http://shipilev.net/#benchmarking">the talks</a> of one of the main authors from JMH.</p>
          
          <h2 id="wiki-h2-2">
          <a name="customizing-runtime-conditions" class="anchor" href="#customizing-runtime-conditions"><span class="octicon octicon-link"></span></a>Customizing Runtime Conditions</h2>
          
          <p>The default settings (as found in <code>AbstractMicrobenchmark</code>) are:</p>
          
          <ul>
          <li>Warmup Iterations: 10</li>
          <li>Measure Iterations: 10</li>
          <li>Number of Forks: 2</li>
          </ul>
          <p>These settings can be customized through system properties at runtime (<code>warmupIterations</code>, <code>measureIterations</code> and <code>forks</code>):</p>
          
          <div class="highlight"><pre><span class="n">mvn</span> <span class="o">-</span><span class="n">DskipTests</span><span class="o">=</span><span class="nb">false</span> <span class="o">-</span><span class="n">DwarmupIterations</span><span class="o">=</span><span class="mi">2</span> <span class="o">-</span><span class="n">DmeasureIterations</span><span class="o">=</span><span class="mi">3</span> <span class="o">-</span><span class="n">Dforks</span><span class="o">=</span><span class="mi">1</span> <span class="n">test</span></pre></div>
          
          <p>Note that it is generally not advised to use that few iterations, but it sometimes is helpful to see if the benchmark works and then run comprehensive benchmarks at a later point.</p>
          
          <p>Note that you can also customize those default settings on a per-test basis through annotations:</p>
          
          <div class="highlight"><pre><span class="nd">@Warmup</span><span class="o">(</span><span class="n">iterations</span> <span class="o">=</span> <span class="mi">20</span><span class="o">)</span>&#x000A;<span class="nd">@Fork</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>&#x000A;<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyBenchmark</span> <span class="kd">extends</span> <span class="n">AbstractMicrobenchmark</span> <span class="o">{</span>&#x000A;&#x000A;<span class="o">}</span></pre></div>
          
          <p>This can be done on a per-class and per-method (benchmark) basis. Note that command line arguments always override the annotation defaults.</p>
              </div>
            </div></div>
          <div class="toc-container col-md-3 hidden-xs hidden-sm hidden-print" role="complementary">
          <div class="toc well">
          <ul class="nav nav-list nav-stacked">
          <li class="nav-header">Table of Contents
          </li><li><a href="#wiki-h2-0" title="Running the Benchmarks">Running the Benchmarks</a>
          </li><li><a href="#wiki-h2-1" title="Writing Benchmarks">Writing Benchmarks</a>
          </li><li><a href="#wiki-h2-2" title="Customizing Runtime Conditions">Customizing Runtime Conditions</a>
          </li></ul>
          </div>
          </div>
          </div>
          <div class="row">
            <div class="col-md-9">
              <div class="text-right">
                <small>Last retrieved on 21-Jan-2014</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="container">
      <hr>
      <footer id="footer">
        <p>
          Copyright &copy; 2014
          <a href="../index.html">The Netty project</a>
        </p>
      </footer>
    </div>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js" type="text/javascript"></script>
    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="../lib/common.footer.js" type="text/javascript"></script>
  
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker('UA-95307-5');
pageTracker._trackPageview();
} catch(err) {}</script>
</body>
</html>
